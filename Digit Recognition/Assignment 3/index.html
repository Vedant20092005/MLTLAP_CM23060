<!DOCTYPE html>
<html>
<head>
    <title>MNIST: CNN vs Dense Final</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; text-align: center; }
        canvas { border: 2px solid #000; background: black; cursor: crosshair; margin-bottom: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
        button { padding: 10px 20px; cursor: pointer; border-radius: 4px; border: none; background: #333; color: white; }
        .digit { font-size: 3rem; font-weight: bold; display: block; }
    </style>
</head>
<body>

<h1>CNN vs Dense Comparison</h1>
<p id="status">Status: Initializing...</p>

<canvas id="canvas" width="140" height="140"></canvas><br>
<button onclick="clearCanvas()">Clear</button>
<button id="predict-btn" onclick="predictBoth()" disabled>Classify Digit</button>

<div class="grid">
    <div class="card">
        <strong>CNN Prediction</strong>
        <span id="cnn-digit" class="digit" style="color:#27ae60;">-</span>
    </div>
    <div class="card">
        <strong>Dense Prediction</strong>
        <span id="dense-digit" class="digit" style="color:#2980b9;">-</span>
    </div>
</div>

<script>
let cnnModel, denseModel;

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let drawing = false;

/* -------- Canvas Functions -------- */
function clearCanvas() {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

canvas.onmousedown = () => drawing = true;
canvas.onmouseup = () => { drawing = false; ctx.beginPath(); };
canvas.onmousemove = (e) => {
    if (!drawing) return;
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(e.offsetX, e.offsetY, 6, 0, Math.PI * 2);
    ctx.fill();
};

/* -------- Model Init -------- */
async function init() {

    // CNN Model
    cnnModel = tf.sequential();
    cnnModel.add(tf.layers.conv2d({
        inputShape: [28, 28, 1],
        filters: 16,
        kernelSize: 3,
        activation: 'relu'
    }));
    cnnModel.add(tf.layers.flatten());
    cnnModel.add(tf.layers.dense({ units: 10, activation: 'softmax' }));
    cnnModel.compile({
        optimizer: 'adam',
        loss: 'categoricalCrossentropy'
    });

    // Dense Model
    denseModel = tf.sequential();
    denseModel.add(tf.layers.flatten({ inputShape: [28, 28, 1] }));
    denseModel.add(tf.layers.dense({ units: 128, activation: 'relu' }));
    denseModel.add(tf.layers.dense({ units: 10, activation: 'softmax' }));
    denseModel.compile({
        optimizer: 'adam',
        loss: 'categoricalCrossentropy'
    });

    document.getElementById('status').innerText = "Status: Ready!";
    document.getElementById('predict-btn').disabled = false;
}

/* -------- Prediction -------- */
function predictBoth() {
    tf.tidy(() => {
        const img = tf.browser.fromPixels(canvas, 1)
            .resizeBilinear([28, 28])
            .toFloat()
            .div(255)
            .expandDims(0);

        const cnnRes = cnnModel.predict(img).argMax(1).dataSync()[0];
        const denseRes = denseModel.predict(img).argMax(1).dataSync()[0];

        document.getElementById('cnn-digit').innerText = cnnRes;
        document.getElementById('dense-digit').innerText = denseRes;

        console.log(`CNN: ${cnnRes}, Dense: ${denseRes}`);
    });
}

/* -------- Start -------- */
init();
clearCanvas();
</script>

</body>
</html>
